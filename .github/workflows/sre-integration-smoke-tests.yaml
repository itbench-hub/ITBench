name: Perform integration smoke tests for SRE scenarios

on:
  pull_request:
    branches:
      - main
    paths:
      - scenarios/sre/dev/local_cluster/go.*
      - scenarios/sre/playbooks/manage_agent_access.yaml
      - scenarios/sre/playbooks/manage_applications.yaml
      - scenarios/sre/playbooks/manage_documentation.yaml
      - scenarios/sre/playbooks/manage_faults.yaml
      - scenarios/sre/playbooks/manage_recorders.yaml
      - scenarios/sre/playbooks/manage_tools.yaml
      - scenarios/sre/roles/**
      - '!scenarios/sre/roles/awx/**'

concurrency:
  group: ci-integration-${{ github.ref }}
  cancel-in-progress: true

jobs:
  agent-access:
    name: Agent Access Smoke Tests
    needs:
      - chaos-mesh
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=26 make -C scenarios/sre create_environment
      - name: Test access granting
        run: |
          make -C scenarios/sre enable_agent_access
      - name: Test access revoking
        run: |
          make -C scenarios/sre disable_agent_access
  bookinfo:
    name: Istio Book Info Smoke Tests
    needs:
      - istio
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/istio.yaml scenarios/sre/group_vars/environment/tools.yaml
          mv scenarios/sre/tests/files/bookinfo.yaml scenarios/sre/group_vars/environment/applications.yaml
      - name: Install tools
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_applications
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_applications
  chaos-mesh:
    name: Chaos Mesh Smoke Tests
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/chaos-mesh.yaml scenarios/sre/group_vars/environment/tools.yaml
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_tools
      - name: Run remove custom resource definitions
        run: |
          make -C scenarios/sre remove_tools_crds
  clickhouse:
    name: Alinity Clickhouse Smoke Tests
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/clickhouse.yaml scenarios/sre/group_vars/environment/tools.yaml
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_tools
      - name: Run remove custom resource definitions
        run: |
          make -C scenarios/sre remove_tools_crds
  istio:
    name: Istio Smoke Tests
    runs-on: ubuntu-24.04
    needs:
      - clickhouse
      - jaeger
      - kubernetes-topology-monitor
      - opencost
      - prometheus
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/istio.yaml scenarios/sre/group_vars/environment/tools.yaml
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_tools
      - name: Run remove custom resource definitions
        run: |
          make -C scenarios/sre remove_tools_crds
  jaeger:
    name: Jaeger Smoke Tests
    runs-on: ubuntu-24.04
    needs:
      - opentelemetry
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/jaeger.yaml scenarios/sre/group_vars/environment/tools.yaml
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run data recorder installation smoke test
        run: |
          make -C scenarios/sre deploy_recorders
      - name: Run data recorder uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_recorders
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_tools
      - name: Run remove custom resource definitions
        run: |
          make -C scenarios/sre remove_tools_crds
  kubernetes-metrics-server:
    name: Kubernetes Metrics Server Smoke Tests
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/kubernetes-metrics-server.yaml scenarios/sre/group_vars/environment/tools.yaml
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_tools
      - name: Run remove custom resource definitions
        run: |
          make -C scenarios/sre remove_tools_crds
  kubernetes-topology-monitor:
    name: Kubernetes Topology Monitor Smoke Tests
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/kubernetes-topology-monitor.yaml scenarios/sre/group_vars/environment/tools.yaml
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run data recorder installation smoke test
        run: |
          make -C scenarios/sre deploy_recorders
      - name: Run data recorder uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_recorders
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_tools
      - name: Run remove custom resource definitions
        run: |
          make -C scenarios/sre remove_tools_crds
  opencost:
    name: OpenCost Smoke Tests
    needs:
      - prometheus
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/opencost.yaml scenarios/sre/group_vars/environment/tools.yaml
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_tools
      - name: Run remove custom resource definitions
        run: |
          make -C scenarios/sre remove_tools_crds
  opentelemetry:
    name: OpenTelemetry Collector Smoke Tests
    needs:
      - clickhouse
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/opentelemetry.yaml scenarios/sre/group_vars/environment/tools.yaml
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_tools
      - name: Run remove custom resource definitions
        run: |
          make -C scenarios/sre remove_tools_crds
  otel-demo:
    name: OpenTelemetry Demo (Astronomy Shop) Smoke Tests
    needs:
      - clickhouse
      - jaeger
      - prometheus
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/otel-demo.yaml scenarios/sre/group_vars/environment/applications.yaml
      - name: Install tools
        run: |
          SCENARIO_NUMBER=1 make -C scenarios/sre deploy_tools
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_applications
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_applications
  prometheus:
    name: Prometheus Smoke Tests
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
          mv scenarios/sre/tests/files/prometheus.yaml scenarios/sre/group_vars/environment/tools.yaml
      - name: Run installation smoke test
        run: |
          make -C scenarios/sre deploy_tools
      - name: Run data recorder installation smoke test
        run: |
          make -C scenarios/sre deploy_recorders
      - name: Run data recorder uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_recorders
      - name: Run uninstallation smoke test
        run: |
          make -C scenarios/sre undeploy_tools
      - name: Run remove custom resource definitions
        run: |
          make -C scenarios/sre remove_tools_crds
  sre-scenario-1:
    name: SRE Scenario 1 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=1 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=1 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=1 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=1 make -C scenarios/sre destroy_environment
  sre-scenario-3:
    name: SRE Scenario 3 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=3 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=3 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=3 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=3 make -C scenarios/sre destroy_environment
  sre-scenario-16:
    name: SRE Scenario 16 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=16 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=16 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=16 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=16 make -C scenarios/sre destroy_environment
  sre-scenario-20:
    name: SRE Scenario 20 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=20 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=20 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=20 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=20 make -C scenarios/sre destroy_environment
  sre-scenario-23:
    name: SRE Scenario 23 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=23 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=23 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=23 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=23 make -C scenarios/sre destroy_environment
  sre-scenario-26:
    name: SRE Scenario 26 Smoke Test
    needs:
      - chaos-mesh
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=26 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=26 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=26 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=26 make -C scenarios/sre destroy_environment
  sre-scenario-30:
    name: SRE Scenario 30 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=30 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=30 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=30 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=30 make -C scenarios/sre destroy_environment
  sre-scenario-31:
    name: SRE Scenario 31 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=31 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=31 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=31 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=31 make -C scenarios/sre destroy_environment
  sre-scenario-33:
    name: SRE Scenario 33 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=33 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=33 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=33 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=33 make -C scenarios/sre destroy_environment
  sre-scenario-34:
    name: SRE Scenario 34 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=34 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=34 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=34 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=34 make -C scenarios/sre destroy_environment
  sre-scenario-40:
    name: SRE Scenario 40 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=40 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=40 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=40 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=40 make -C scenarios/sre destroy_environment
  sre-scenario-41:
    name: SRE Scenario 41 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=41 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=41 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=41 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=41 make -C scenarios/sre destroy_environment
  sre-scenario-43:
    name: SRE Scenario 43 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=43 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=43 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=43 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=43 make -C scenarios/sre destroy_environment
  sre-scenario-45:
    name: SRE Scenario 45 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=45 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=45 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=45 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=45 make -C scenarios/sre destroy_environment
  sre-scenario-46:
    name: SRE Scenario 46 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=46 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=46 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=46 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=46 make -C scenarios/sre destroy_environment
  sre-scenario-47:
    name: SRE Scenario 47 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - prometheus
      - bookinfo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=47 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=47 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=47 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=47 make -C scenarios/sre destroy_environment
  sre-scenario-48:
    name: SRE Scenario 48 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - prometheus
      - bookinfo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=48 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=48 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=48 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=48 make -C scenarios/sre destroy_environment
  sre-scenario-49:
    name: SRE Scenario 49 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=49 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=49 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=49 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=49 make -C scenarios/sre destroy_environment
  sre-scenario-50:
    name: SRE Scenario 50 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - prometheus
      - bookinfo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=50 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=50 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=50 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=50 make -C scenarios/sre destroy_environment
  sre-scenario-102:
    name: SRE Scenario 102 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=102 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=102 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=102 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=102 make -C scenarios/sre destroy_environment
  sre-scenario-105:
    name: SRE Scenario 105 Smoke Test
    needs:
      - kubernetes-topology-monitor
      - opentelemetry
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=105 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=105 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=105 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=105 make -C scenarios/sre destroy_environment
  finops-scenario-37:
    name: FinOps Scenario 37 Smoke Test
    needs:
      - kubernetes-metrics-server
      - kubernetes-topology-monitor
      - opentelemetry
      - opencost
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=37 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=37 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=37 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=37 make -C scenarios/sre destroy_environment
  finops-scenario-38:
    name: FinOps Scenario 38 Smoke Test
    needs:
      - kubernetes-metrics-server
      - kubernetes-topology-monitor
      - opentelemetry
      - opencost
      - otel-demo
    runs-on: ubuntu-24.04
    steps:
      - uses: actions/checkout@v6.0.2
      - uses: astral-sh/setup-uv@v7.2.1
        with:
          working-directory: scenarios/sre
      - uses: actions/setup-go@v6.2.0
        with:
          go-version-file: scenarios/sre/dev/local_cluster/go.mod
          cache-dependency-path: scenarios/sre/dev/local_cluster/go.sum
      - uses: azure/setup-helm@v4.3.1
        with:
          version: v3.18.6
      - name: Create Kind cluster
        run: |
          make -C scenarios/sre/dev/local_cluster create_simple_cluster
      - name: Run Cloud Provider
        run: |
          make -C scenarios/sre/dev/local_cluster run_service_provider &
      - name: Install project dependencies
        run: |
          make -C scenarios/sre deps
      - name: Create group vars
        run: |
          make -C scenarios/sre group_vars
      - name: Create environment
        run: |
          SCENARIO_NUMBER=38 make -C scenarios/sre create_environment
      - name: Test fault injection
        run: |
          SCENARIO_NUMBER=38 make -C scenarios/sre inject_scenario_fault
      - name: Test fault removal
        run: |
          SCENARIO_NUMBER=38 make -C scenarios/sre remove_scenario_fault
      - name: Destroy environment
        run: |
          SCENARIO_NUMBER=38 make -C scenarios/sre destroy_environment
