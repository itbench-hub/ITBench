---
apiVersion: itbench.io/v2
kind: GroundTruth
metadata:
  name: scenario-116
spec:
  alerts:
    - labels: {}
      name: HighRequestLatency
    - labels: {}
      name: HighRequestErrorRate
  entities:
    - apiVersion: chaos-mesh.org/v1alpha1
      kind: Schedule
      metadata:
        name: valkey-cart-stress-chaos
        namespace: chaos-mesh
    - apiVersion: chaos-mesh.org/v1alpha1
      kind: Schedule
      metadata:
        name: valkey-cart-io-chaos
        namespace: chaos-mesh
  solutions:
    - - steps:
          - command: kubectl -n chaos-mesh annotate schedule valkey-cart-stress-chaos experiment.chaos-mesh.org/pause='true'
            text: Annotate the StressChaos schedule to pause the active experiment.
          - command: kubectl -n chaos-mesh get stresschaos --selector='experiment.chaos-mesh.org/pause=true'
            text: Retrieve the associated StressChaos experiment managed by the schedule.
          - text: Delete the retrieved StressChaos experiment after it has entered the Paused state.
          - command: kubectl -n chaos-mesh delete schedule valkey-cart-stress-chaos
            text: Delete the StressChaos schedule.
          - command: kubectl -n chaos-mesh annotate schedule valkey-cart-io-chaos experiment.chaos-mesh.org/pause='true'
            text: Annotate the IOChaos schedule to pause the active experiment.
          - command: kubectl -n chaos-mesh get iochaos --selector='experiment.chaos-mesh.org/pause=true'
            text: Retrieve the associated IOChaos experiment managed by the schedule.
          - text: Delete the retrieved IOChaos experiment after it has entered the Paused state.
          - command: kubectl -n chaos-mesh delete schedule valkey-cart-io-chaos
            text: Delete the IOChaos schedule.
      - steps:
          - command: kubectl -n chaos-mesh delete schedule valkey-cart-stress-chaos valkey-cart-io-chaos
            text: Delete both Chaos Mesh schedules to stop the experiments.
          - command: kubectl -n otel-demo delete stresschaos,iochaos -l app.kubernetes.io/managed-by=ITBench
            text: Delete any lingering chaos experiments that may still be running.
      - steps:
          - command: kubectl -n otel-demo get pods -l app.kubernetes.io/component=valkey-cart
            text: Check the status of Valkey pods to verify they are running.
          - command: kubectl -n otel-demo delete pod -l app.kubernetes.io/component=valkey-cart
            text: Force restart the Valkey pods after removing chaos experiments to ensure clean state.
