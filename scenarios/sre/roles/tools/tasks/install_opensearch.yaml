---
- name: Create Namespace for OpenSearch
  kubernetes.core.k8s:
    kubeconfig: "{{ tools_cluster.kubeconfig }}"
    state: present
    template: templates/kubernetes/opensearch/namespace.j2

- name: Install OpenSearch
  kubernetes.core.helm:
    chart_ref: "{{ tools_managers.opensearch.helm.chart.reference }}"
    chart_repo_url: "{{ tools_managers.opensearch.helm.chart.repository }}"
    chart_version: "{{ tools_managers.opensearch.helm.chart.version }}"
    kubeconfig: "{{ tools_cluster.kubeconfig }}"
    release_name: "{{ tools_managers.opensearch.helm.release.name }}"
    release_namespace: "{{ tools_managers.opensearch.kubernetes.namespace }}"
    release_state: present
    timeout: 10m
    values: |-
      {{
        lookup('ansible.builtin.template', 'templates/helm/opensearch/values.j2') |
        ansible.builtin.from_yaml
      }}
    wait: true
